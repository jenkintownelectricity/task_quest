{
  "$lds": {
    "v": "1.0.0",
    "type": "layer.abyss",
    "id": "lds:voice/L1-abyss-v1",
    "created": "2026-01-15T00:00:00Z",
    "layer": 1,
    "name": "ABYSS"
  },

  "layer": {
    "name": "L1 Abyss - Persistence",
    "sense": "Storage",
    "ocean_metaphor": "The deepest waters where data permanently rests under immense pressure",
    "temperature": "freezing",
    "flow": "persist"
  },

  "components": {
    "supabase_client": {
      "id": "supabase.client",
      "config": {
        "url_env": "SUPABASE_URL",
        "key_env": "SUPABASE_ANON_KEY"
      },
      "tables": {
        "profiles": "tq_profiles",
        "task_completions": "tq_task_completions",
        "achievements": "tq_achievements_unlocked",
        "rewards": "tq_reward_purchases",
        "daily_summaries": "tq_daily_summaries",
        "family_links": "tq_family_links",
        "family_members": "tq_family_members",
        "audit_log": "tq_audit_log"
      },
      "rls_enabled": true
    },

    "local_storage": {
      "id": "local.storage",
      "keys": {
        "session": "tq_session",
        "preferences": "tq_prefs",
        "offline_queue": "tq_offline_queue",
        "cache": "tq_cache"
      },
      "encryption": false,
      "fallback_mode": true
    },

    "sync_manager": {
      "id": "sync.manager",
      "strategy": "eventual_consistency",
      "offline_support": true,
      "conflict_resolution": "server_wins",
      "sync_events": [
        {"trigger": "online", "action": "push_offline_queue"},
        {"trigger": "session_start", "action": "pull_fresh_data"},
        {"trigger": "task_complete", "action": "immediate_sync"}
      ]
    },

    "audit_logger": {
      "id": "audit.logger",
      "enabled": true,
      "logs_to": "tq_audit_log",
      "captures": ["actor_id", "action", "target_table", "target_id", "details", "ip_address"],
      "hipaa_compliant": true
    }
  },

  "data_operations": {
    "create_profile": {
      "table": "tq_profiles",
      "required": ["id", "name", "role"],
      "defaults": {
        "current_level": 1,
        "total_xp": 0,
        "coins": 0,
        "current_streak": 0
      }
    },
    "record_task_completion": {
      "table": "tq_task_completions",
      "required": ["profile_id", "task_id", "task_category"],
      "auto_fields": ["completed_at", "completion_date"],
      "triggers": ["update_profile_xp", "check_achievements", "update_streak"]
    },
    "unlock_achievement": {
      "table": "tq_achievements_unlocked",
      "required": ["profile_id", "achievement_id"],
      "auto_fields": ["unlocked_at"]
    },
    "purchase_reward": {
      "table": "tq_reward_purchases",
      "required": ["profile_id", "reward_id", "cost_coins"],
      "validates": ["sufficient_coins"],
      "auto_fields": ["purchased_at"]
    }
  },

  "inference": {
    "receives_from": ["L2_DEEP"],
    "outputs_to": ["L2_DEEP"],
    "requires": ["supabase_connection", "auth_token"]
  }
}
